{"type":"getPostById","data":{"title":"getFileList 获取文件夹列表","date":"2022-08-03T05:39:34.000Z","description":"","categories":[{"name":"技术","_id":"cl8x1d8b5000dkw49eu9b2oag"},{"name":"Lua","_id":"cl8x1d8bw0016kw492l4848bz"}],"tags":[{"name":"Dice","_id":"cl8x1d8b4000ckw49a83b91xo"}],"content":"<div class=\"note success\"><p><strong>getFileList</strong><br>简单的调用控制台获取文件夹列表实例</p>\n</div>\n\n<h1 id=\"获取文件夹列表\"><a href=\"#获取文件夹列表\" class=\"headerlink\" title=\"获取文件夹列表\"></a>获取文件夹列表</h1><blockquote>\n<p>使用《署名—非商业性使用—相同方式共享 4.0 协议国际版》（CC BY-NC-SA 4.0）进行授权。<br><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9sZWdhbGNvZGUuemgtSGFucw==\">https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode.zh-Hans<i class=\"fa fa-external-link-alt\"></i></span></p>\n</blockquote>\n<p>[ toc ]</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">System</th>\n<th align=\"center\">statement</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">Windows</td>\n<td align=\"center\">supported</td>\n</tr>\n<tr>\n<td align=\"left\">Linux</td>\n<td align=\"center\">unsupported</td>\n</tr>\n<tr>\n<td align=\"left\">IOS</td>\n<td align=\"center\">unsupported</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h3><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2N5cHJlc3MwNTIyL2N5cHJlc3MwNTIyLmdpdGh1Yi5pby9yZWxlYXNlcy90YWcvZ2V0RmlsZUxpc3Q=\">getFileList.zip<i class=\"fa fa-external-link-alt\"></i></span></p>\n<h3 id=\"基本信息\"><a href=\"#基本信息\" class=\"headerlink\" title=\"基本信息\"></a>基本信息</h3><ul>\n<li>作者： 简律纯</li>\n<li>联系方式：qq:a2c29k9</li>\n<li>版本：v1.0</li>\n<li>更新日期：2022/08/03</li>\n<li>关键词：<br><code>--getDiceList=</code><br><code>--getRootList=</code></li>\n<li>许可协议：CC BY-NC-SA 4.0</li>\n</ul>\n<h3 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h3><p>利用os库中的os. execute执行cmd指令，达到获取文件夹列表的目的。</p>\n<h3 id=\"须知\"><a href=\"#须知\" class=\"headerlink\" title=\"须知\"></a>须知</h3><p>该脚本只适配win平台，linux版本将会在后续更新（或者你也可以修改脚本，将dir改为ls即可，注意linux斜杠和反斜杠与win的区别），MA暂无解决方法。</p>\n<h3 id=\"用法\"><a href=\"#用法\" class=\"headerlink\" title=\"用法\"></a>用法</h3><blockquote>\n<p><code>--getDiceList=nil</code>与 <code>--getRootList=nil</code>分别用于获取dice根目录列表以及框架根目录列表，后接二级目录或更多（你需要用两个反斜杠<a href=\"\">\\</a>将他们连接）子目录来获取其列表。每次执行命令，脚本将会在dice根目录生成对应的DiceList.txt与RootList.txt，若文件太多发不出来也可以去那边查看。</p>\n</blockquote>\n<h3 id=\"举例\"><a href=\"#举例\" class=\"headerlink\" title=\"举例\"></a>举例</h3><blockquote>\n<p>获取根目录列表<img src=\"https://dice-forum.s3.ap-northeast-1.amazonaws.com/2022-08-03/1659492690-490071-13b5fe1b2faf154d.png\"></p>\n</blockquote>\n<blockquote>\n<p>获取根目录二级或三级文件夹列表<img src=\"https://dice-forum.s3.ap-northeast-1.amazonaws.com/2022-08-03/1659492727-777395-17c81e22d7ab297.png\"><br><strong>获取Dice文件夹二级或更多级文件夹列表同理。</strong></p>\n</blockquote>\n<blockquote>\n<p>获取Dice文件夹列表<img src=\"https://dice-forum.s3.ap-northeast-1.amazonaws.com/2022-08-03/1659492798-371911-1528bb3c4ba6fcb6.png\"></p>\n</blockquote>\n<h3 id=\"后记\"><a href=\"#后记\" class=\"headerlink\" title=\"后记\"></a>后记</h3><figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">---------------------------------------------------------------------</span></span><br><span class=\"line\"><span class=\"comment\">-- @getFileList 获取文件列表.</span></span><br><span class=\"line\"><span class=\"comment\">-- Author @简律纯(qq:a2c29k9)</span></span><br><span class=\"line\"><span class=\"comment\">-- @License MIT.</span></span><br><span class=\"line\"><span class=\"comment\">-- 2022/08/03</span></span><br><span class=\"line\"><span class=\"comment\">---------------------------------------------------------------------</span></span><br><span class=\"line\"></span><br><span class=\"line\">msg_order=&#123;[<span class=\"string\">&quot;--getDiceList=&quot;</span>]=<span class=\"string\">&quot;getDiceList&quot;</span>,[<span class=\"string\">&quot;--getRootList=&quot;</span>]=<span class=\"string\">&quot;getRootList&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">read_file = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(path,mode1,mode2)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">local</span> text = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">local</span> file = <span class=\"built_in\">io</span>.<span class=\"built_in\">open</span>(<span class=\"built_in\">path</span>,mode1)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (file ~= <span class=\"literal\">nil</span>) <span class=\"keyword\">then</span></span><br><span class=\"line\">      text = file.<span class=\"built_in\">read</span>(file, mode2)</span><br><span class=\"line\">      <span class=\"built_in\">io</span>.<span class=\"built_in\">close</span>(file)</span><br><span class=\"line\">    <span class=\"keyword\">else</span> </span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&quot;没有找到文件哦~&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> text</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">getLineCount = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(path)</span></span></span><br><span class=\"line\"><span class=\"keyword\">local</span> BUFSIZE = <span class=\"number\">2</span>^<span class=\"number\">13</span></span><br><span class=\"line\"><span class=\"keyword\">local</span> f = <span class=\"built_in\">io</span>.<span class=\"built_in\">input</span>(<span class=\"built_in\">path</span>)</span><br><span class=\"line\"><span class=\"keyword\">local</span> lc = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">true</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"keyword\">local</span> <span class=\"built_in\">lines</span>,rest = f:<span class=\"built_in\">read</span>(BUFSIZE,<span class=\"string\">&#x27;*line&#x27;</span>)</span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> <span class=\"built_in\">lines</span> <span class=\"keyword\">then</span> <span class=\"keyword\">break</span> <span class=\"keyword\">end</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> rest <span class=\"keyword\">then</span> <span class=\"built_in\">lines</span> = <span class=\"built_in\">lines</span> .. rest .. <span class=\"string\">&#x27;\\n&#x27;</span> <span class=\"keyword\">end</span></span><br><span class=\"line\">        <span class=\"keyword\">local</span> _,t = <span class=\"built_in\">string</span>.<span class=\"built_in\">gsub</span>(<span class=\"built_in\">lines</span>,<span class=\"string\">&quot;%S+&quot;</span>,<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">        _,t = <span class=\"built_in\">string</span>.<span class=\"built_in\">gsub</span>(<span class=\"built_in\">lines</span>,<span class=\"string\">&quot;\\n&quot;</span>,<span class=\"string\">&quot;\\n&quot;</span>)</span><br><span class=\"line\">        lc = lc + t</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">return</span> lc</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">getDiceList = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(msg)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">local</span> <span class=\"built_in\">path</span> = <span class=\"built_in\">string</span>.<span class=\"built_in\">sub</span>(msg.fromMsg,#<span class=\"string\">&#x27;--getDiceList=&#x27;</span>+<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">local</span> Dir = <span class=\"built_in\">path</span></span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">path</span> == <span class=\"string\">&#x27;nil&#x27;</span> <span class=\"keyword\">then</span> Dir = <span class=\"literal\">nil</span> <span class=\"keyword\">end</span></span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> Dir <span class=\"keyword\">then</span> </span><br><span class=\"line\">        cmd = <span class=\"string\">&#x27;dir &#x27;</span>.. getDiceDir()..<span class=\"string\">&#x27;\\\\&#x27;</span>..<span class=\"built_in\">path</span>..<span class=\"string\">&#x27; /b &gt;&#x27;</span>..getDiceDir()..<span class=\"string\">&#x27;//DiceList.txt&#x27;</span></span><br><span class=\"line\">        <span class=\"built_in\">os</span>.<span class=\"built_in\">execute</span>(cmd)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        cmd = <span class=\"string\">&#x27;dir &#x27;</span>.. getDiceDir()..<span class=\"string\">&#x27; /b &gt;&#x27;</span>..getDiceDir()..<span class=\"string\">&#x27;//DiceList.txt&#x27;</span></span><br><span class=\"line\">        <span class=\"built_in\">os</span>.<span class=\"built_in\">execute</span>(cmd)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> read_file(getDiceDir()..<span class=\"string\">&#x27;//DiceList.txt&#x27;</span>,<span class=\"string\">&#x27;r&#x27;</span>,<span class=\"string\">&#x27;*a&#x27;</span>)..<span class=\"built_in\">os</span>.<span class=\"built_in\">date</span>(<span class=\"string\">&#x27;\\n%x&#x27;</span>)..<span class=\"string\">&#x27;\\n文件夹与文件共 &#x27;</span>..getLineCount(getDiceDir()..<span class=\"string\">&#x27;//DiceList.txt&#x27;</span>)..<span class=\"string\">&#x27; 个&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">getRootList = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(msg)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">local</span> <span class=\"built_in\">path</span> = <span class=\"built_in\">string</span>.<span class=\"built_in\">sub</span>(msg.fromMsg,#<span class=\"string\">&#x27;--getRootList=&#x27;</span>+<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">local</span> Dir = <span class=\"built_in\">path</span></span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">path</span> == <span class=\"string\">&#x27;nil&#x27;</span> <span class=\"keyword\">then</span> Dir = <span class=\"literal\">nil</span> <span class=\"keyword\">end</span></span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> Dir <span class=\"keyword\">then</span> </span><br><span class=\"line\">        cmd = <span class=\"string\">&#x27;dir &#x27;</span>..<span class=\"built_in\">path</span>..<span class=\"string\">&#x27; /b &gt;&#x27;</span>..getDiceDir()..<span class=\"string\">&#x27;//RootList.txt&#x27;</span></span><br><span class=\"line\">        <span class=\"built_in\">os</span>.<span class=\"built_in\">execute</span>(cmd)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        cmd = <span class=\"string\">&#x27;dir /b &gt;&#x27;</span>..getDiceDir()..<span class=\"string\">&#x27;//RootList.txt&#x27;</span></span><br><span class=\"line\">        <span class=\"built_in\">os</span>.<span class=\"built_in\">execute</span>(cmd)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> read_file(getDiceDir()..<span class=\"string\">&#x27;//RootList.txt&#x27;</span>,<span class=\"string\">&#x27;r&#x27;</span>,<span class=\"string\">&#x27;*a&#x27;</span>)..<span class=\"built_in\">os</span>.<span class=\"built_in\">date</span>(<span class=\"string\">&#x27;\\n%x&#x27;</span>)..<span class=\"string\">&#x27;\\n文件夹与文件共 &#x27;</span>..getLineCount(getDiceDir()..<span class=\"string\">&#x27;//RootList.txt&#x27;</span>)..<span class=\"string\">&#x27; 个&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>","_path":"2022/08/03/getFileList/","_link":"https://cypress.github.io/2022/08/03/getFileList/","_id":"cl8x1d8bj000nkw495ofo6xd4"}}