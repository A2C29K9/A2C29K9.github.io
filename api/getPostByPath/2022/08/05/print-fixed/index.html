{"type":"getPostByPath","data":{"title":"改写print","date":"2022-08-04T16:00:00.000Z","description":"","categories":[{"name":"技术","_id":"cl8t4519o000db049aot3935v"},{"name":"Lua","_id":"cl8t451av0016b049ca5sbjyo"}],"tags":[{"name":"FIXED","_id":"cl8t451aq0010b0493strgrkm"}],"content":"<div class=\"note success\"><p><strong>print fixed</strong><br>简单实现改写print，将print内容写入文件生成日志。</p>\n</div>\n\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-------------------------------------------------------------------------------</span></span><br><span class=\"line\"><span class=\"comment\">-- Print 改写. @简律纯 @gexi</span></span><br><span class=\"line\"><span class=\"comment\">-------------------------------------------------------------------------------</span></span><br><span class=\"line\">writeToFile = <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"params\">( str )</span></span></span><br><span class=\"line\">    <span class=\"keyword\">local</span> filename = <span class=\"string\">&quot;print.log&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> fileLogOut <span class=\"keyword\">then</span></span><br><span class=\"line\">        fileLogOut = <span class=\"built_in\">io</span>.<span class=\"built_in\">open</span>(filename, <span class=\"string\">&quot;w&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        fileLogOut = <span class=\"built_in\">io</span>.<span class=\"built_in\">open</span>(filename, <span class=\"string\">&quot;a&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">    fileLogOut:<span class=\"built_in\">write</span>(<span class=\"built_in\">os</span>.<span class=\"built_in\">date</span>(<span class=\"string\">&quot;%H:%M:%S&quot;</span>,<span class=\"built_in\">os</span>.<span class=\"built_in\">time</span>())..<span class=\"string\">&quot; &quot;</span>..str..<span class=\"string\">&quot;\\n&quot;</span>)</span><br><span class=\"line\">    fileLogOut:<span class=\"built_in\">close</span>()</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">babe_tostring</span><span class=\"params\">(...)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">local</span> num = <span class=\"built_in\">select</span>(<span class=\"string\">&quot;#&quot;</span>, ...);</span><br><span class=\"line\">    <span class=\"keyword\">local</span> args = &#123; ... &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">local</span> outs = &#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i = <span class=\"number\">1</span>, num <span class=\"keyword\">do</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> i &gt; <span class=\"number\">1</span> <span class=\"keyword\">then</span></span><br><span class=\"line\">            outs[#outs + <span class=\"number\">1</span>] = <span class=\"string\">&quot;\\t&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">end</span></span><br><span class=\"line\">        outs[#outs + <span class=\"number\">1</span>] = <span class=\"built_in\">tostring</span>(args[i]);</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">table</span>.<span class=\"built_in\">concat</span>(outs);</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">local</span> just_print = <span class=\"built_in\">print</span>;</span><br><span class=\"line\"><span class=\"keyword\">local</span> babe_output = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(...)</span></span></span><br><span class=\"line\">    just_print(...);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">local</span> str = babe_tostring(...);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> writeToFile <span class=\"keyword\">then</span> writeToFile(str) <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"built_in\">print</span> = babe_output</span><br></pre></td></tr></table></figure>","_path":"2022/08/05/print-fixed/","_link":"https://cypress.github.io/2022/08/05/print-fixed/","_id":"cl8t451ac000rb0491fhv29ju"}}